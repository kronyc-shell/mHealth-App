<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Material Design for Bootstrap fonts and icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->

    <link rel="stylesheet" href="../css/bootstrap.css">


    <!-- <link rel="stylesheet" href="../css/bootstrap-material-design.css"> -->

    <link rel="stylesheet" href="../css/main.css">

    <title>Login</title>
  </head>


  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <button type="button" class="btn btn-main btn-block btn-sm" name="button" onclick="window.location.replace('index.html')" id="9">Goto Dashboard</button>
        </div>
        <div class="col">
          <button onclick="patientNavigation(localStorage.getItem('lang'))" id="11" type="button" class="btn btn-main-2 btn-block btn-sm" name="button">Navigate Patient</button>
        </div>
      </div>
    </div>


    <div class="container">
      <div class="row" id="">
        <div class="col-sm-12">
          <!-- Modal -->
          <div class="modal fade" id="no_specimen_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                  <!--TODO: include some translations here for french -->
                  <h5 class="modal-title" id="12">Very Important Alert!</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <h5 id="13">No Lab Results recorded</h5>
                </div>
                <div class="modal-footer">
                  <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                  <button onclick="patientNavigation(localStorage.getItem('lang'))" id="14" type="button" class="btn btn-main-2 btn-block btn-sm" name="button">Navigate Patient</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <h2 style="font-weight: 100; font-size: 20px; text-align: center" id="8">Follow up</h2>
          <hr>
          <div id="animationWindow"></div>
          <div id="main_display">
            <div class="form-group">
              <label for="patient_name" id="10">Patient's name and ID</label>
              <input type="text" id="patient_name" disabled class="form-control">
              <script>
                document.getElementById("patient_name").placeholder = JSON.parse(sessionStorage.getItem("patient")).id + " | " + JSON.parse(sessionStorage.getItem("patient")).name;
              </script>
            </div>
            <div id="lab_results_record" hidden>
              <div class="jumbotron">
                <h5 id="7">Lab Results</h5>
                <u><small>SMR results</small></u>
                <p><small id="result1">Result 1: </small> <br> <small id="result2">Result 2: </small></p>
                <u><small>Xpert results</small></u>
                <p><small id="result_1">MTB: </small> <br><small id="mtb_grade">Grade: </small><br> <small id="result_2">RIF: </small></p>
              </div>
            </div><hr>
            <div class="card">
              <script>
                document.getElementById("patient_name").innerHTML = sessionStorage.getItem("userName");
              </script>
              <div class="card-body" id="follow_up_action">
                <form id="follow_up_form">
                  <!-- <h5 class="card-title" style="font-weight: 100">Follow-up action taken</h5> -->
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="xray">
                    <label class="custom-control-label form-check-label" for="xray" id="0">X-RAY</label>
                  </div>
                  <div class="custom-control custom-checkbox">
                    <input value="" type="checkbox" class="custom-control-input" id="amoxicilin">
                    <label class="custom-control-label form-check-label" for="amoxicilin" id="1">Amoxicillin Prescribed</label>
                  </div><br>
                  <div class="form-group">
                    <label for="otherAntibiotic" id="2" style="font-weight: 100">Other Antibiotic</label>
                    <input type="text" class="form-control" id="otherAntibiotic">
                  </div>
                  <div class="form-group" id="fl_up" >
                    <label for="follow_up_date" id="3" style="font-weight: 100">Follow-up Scheduled Date</label>
                    <input type="date" class="form-control" id="follow_up_date">
                    <!-- <script>document.getElementById("follow_up_date").valueAsDate=new Date();</script> -->
                  </div>
                  <div class="form-group">
                    <label for="comments" id="4" style="font-weight: 100">Comments</label>
                    <textarea type="text" id="comments" class="form-control"></textarea>
                  </div>

                  <br>
                  <div class="row">
                    <div class="col">
                      <div class="text-center">
                        <small style="color: white; background-color: grey" id="5">Good Job! <br>Review everything and click record!</small><br>
                        <button type="submit" class="btn btn-succ" name="button" id="6">Record!</button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <br>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../js/jquery.js"></script>
    <script src="../js/popper.js" ></script>
    <script src="../js/bootstrap.js"></script>
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/4.8.0/bodymovin.min.js"></script> -->
    <script type="text/javascript" src="../js/bodymovin.min.js"></script>



    <script src="../js/main.js"></script>
    <script src="js/follow_up.js"></script>
    <script>
      var text = [
        "Radiographie",
        "L'amoxicilline a été prescrite",
        "Autre antibiotique",
        "Date de rendez-vous",
        "Commentaires",
        "Bon travail! <br>Tout revoir et cliquer sur s'inscrire", "Enregistré!",
        "Résultats de laboratoire",
        "Mesures de suivi prises",
        "Retourner au tableau de bord",
        "Nom et ID du patient",
        "Naviguer le patient",
        "Alerte très importante!",
        "Aucun résultat de laboratoire enregistré",
        "Naviguer le patient",
        // "Suivi et mesures prises"
    ];
    </script>
    <script>


    var success = function(sr) {
      sr = sr[0];
      if(typeof(sr) != "undefined") {
        document.getElementById("lab_results_record").removeAttribute("hidden");
        var smr_result1 = document.getElementById("result1");
        var smr_result2 = document.getElementById("result2");

        var xpert_result1 = document.getElementById("result_1");
        var mtb_grade = document.getElementById("mtb_grade");
        var xpert_result2 = document.getElementById("result_2");

        if(localStorage.getItem("lang") == "en") {
          smr_result1.innerHTML += (sr.smr_result_1)
          smr_result2.innerHTML += (sr.smr_result_2)
          xpert_result1.innerHTML += sr.mtb_result;
          mtb_grade.innerHTML += sr.mtb_grade == "" || sr.mtb_grade == null ? "n/a" : sr.mtb_grade;
          xpert_result2.innerHTML += sr.rif_result;
        }
        else {
          smr_result1.innerHTML += quick_results_translate(sr.smr_result_1)
          smr_result2.innerHTML += quick_results_translate(sr.smr_result_2)
          xpert_result1.innerHTML += quick_results_translate(sr.mtb_result);
          mtb_grade.innerHTML += sr.mtb_grade == "" || sr.mtb_grade == null ? "n/a" : quick_results_translate(sr.mtb_grade);
          xpert_result2.innerHTML += quick_results_translate(sr.rif_result);
        }
      }
    }

    var success2 = function(sr) {
      sr = sr[0];
      if(typeof(sr) != "undefined") {
        sessionStorage.setItem("fetch_follow_up", "fetched");
        var form = document.forms['follow_up_form'];
        form.xray.checked = sr.xray;
        form.amoxicilin.checked = sr.amoxicillin;
        form.otherAntibiotic.value = sr.other_antibiotic;
        if( sr.follow_up_scheduled_date == null) form.follow_up_date.value = '';
        else form.follow_up_date.valueAsDate = new Date(sr.follow_up_scheduled_date);
        form.comments.value = sr.comments;
      }
    }

    var failed = function() {}

    var information1 = {
      type : "get",
      uri : `/patients/${JSON.parse(sessionStorage.getItem("patient")).id}/lab`,
      on_success : success,
      on_failed : failed
    }

    var information2 = {
      type : "get",
      uri : `/patients/${JSON.parse(sessionStorage.getItem("patient")).id}/follow_up`,
      on_success : success2,
      on_failed : failed
    }

    transmission_new(information1);
    transmission_new(information2);

    // transmission.fetch("patient", success, failed, "lab");
    // transmission.fetch("patient", success2, failed, "follow_up");

    </script>
  </body>
</html>
