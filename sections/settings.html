<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../css/all.css">

    <link rel="stylesheet" href="../css/bootstrap-material-design.css">
    <!-- <link rel="stylesheet" href="../../css/main.css"> -->

    <title>Login</title>
  </head>

  <body style="background-color: white">

    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <button type="button" class="btn btn-main btn-block btn-sm " style="background-color: #2a53ff; color: white" name="button" onclick="window.location.replace('index.html')" id="0">Goto Dashboard</button>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <br>
      <div class="row">
        <div class="col-12">
          <div hidden id="error_passwords_do_not_match" class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong id="15">Check your passwords</strong> <span id="16">The passwords you entered below do not match! Please verify and try again. </span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <h2 style="font-weight: 100; font-size: 16px; text-align: center" id="1">Configure your account</h2><hr>
        </div>
      </div>
      <div id="animationWindow"></div>

      <div class="row" id="main_display">
        <div class="col-12">
          <form id="user_settings">
            <div class="col-12">
              <small id="2">Get notifications for (uncheck all for none):</small>
            </div>
            <div class="col-12">
              <div id="checkboxes">
                <div class="custom-control custom-checkbox">
                  <input name="notifications" class="custom-control-input" type="checkbox" id="positive_results" value="positive_results">
                  <label class="custom-control-label" for="positive_results" id="3">
                    Positive Results
                  </label>
                </div>

                <div class="custom-control custom-checkbox">
                  <input name="notifications" class="custom-control-input" type="checkbox" id="negative_results" value="negative_results">
                  <label class="custom-control-label" for="negative_results" id="4">
                    Negative Results
                  </label>
                </div>

                <div class="custom-control custom-checkbox">
                  <input name="notifications" class="custom-control-input" type="checkbox" id="error" value="errors">
                  <label class="custom-control-label" for="error" id="5">
                    Errors
                  </label>
                </div>

                <div class="custom-control custom-checkbox">
                  <input name="notifications" onclick="disable_other_notification_options()" class="custom-control-input" type="checkbox" id="all" value="all">
                  <label class="custom-control-label" for="all" id="6">
                    All
                  </label>
                </div>
              </div>
              <hr style="width: 5%">
            </div>
            <div class="col-12">
              <small id="7">Update account:</small>
            </div>
            <div class="col-12">
              <!-- <form id="update_account"> -->
                <div class="form-group">
                  <label for="username" style="font-size: 14px" id="8">Username</label>
                  <input type="text" class="form-control" id="username" required>
                </div>
                <div class="form-group">
                  <label for="password" style="font-size: 14px" id="9">Password</label>
                  <input type="password" class="form-control" id="password" required>
                </div>
                <div class="form-group">
                  <label for="re_password" style="font-size: 14px" id="14">Repeat Password</label>
                  <input type="password" class="form-control" id="re_password" required>
                </div>
                <div class="form-group">
                  <label for="phonenumber" style="font-size: 14px" id="10">Phone Number</label>
                  <input type="text" class="form-control" id="phonenumber" required>
                </div>
                <div class="form-group">
                  <label for="email" style="font-size: 14px" id="11">Email</label>
                  <input type="text" class="form-control" id="email">
                </div>
                <div class="form-group">
                  <label for="service_provider" style="font-size: 14px" id="12">Service Provider</label>
                  <select class="custom-select" id="service_provider">
                    <option></option>
                    <option value="mtn">MTN</option>
                    <option value="orange">Orange</option>
                    <option value="nextel">Nextell</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="region" id="17" style="font-size: 14px">Community</label>
                  <select class="custom-select" id="region">
                    <!-- important information goes in here  -->
                  </select>
                  <select class="custom-select" id="sub_region">
                  </select>
                </div>
              <!-- </form> -->
            </div>
            <div class="col-12 text-center">
              <button type="submit" form="user_settings" style="background-color: #2a53ff; color: white" class="btn btn-main"  id="13">Update</button>
            </div>
          </form>
        </div>
      </div>
      <br>
    </div>
    <script>
    var text = [
      "Aller au panneau de contrôle",
      "Configurez votre compte",
      "Recevoir des notifications pour (décocher tout pour rien)",
      "Résultats positifs",
      "Résultats négatifs",
      "les erreurs",
      "Tous",
      "Compte mis à jour",
      "Nom d'utilisateur",
      "Mot de passe",
      "Numéro de téléphone",
      "Email",
      "Fournisseur de services",
      "Mettre à jour",
      "Répéter le mot de passe",
      "Vérifiez votre mot de passe",
      "Les mots de passe que vous avez entrés ci-dessous ne correspondent pas! Veuillez vérifier et réessayer.",
      "Communauté"
    ];
    </script>
    <script src="../js/jquery.js"></script>
    <script src="../js/popper.js" ></script>
    <script src="../js/bootstrap.js"></script>
    <script type="text/javascript" src="../js/bodymovin.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="js/settings.js"></script>
    <script>
      var user = JSON.parse(localStorage.getItem("user"));
      var user_settings = document.forms['user_settings'];
      if(typeof user.notifications != "undefined") {
        console.log(typeof user.notifications);
        console.log(JSON.parse(user.notifications));
        var notifications = JSON.parse(user.notifications);
        // var notifications = user.notifications;
        for(var i in notifications) {
          // console.log(JSON.parse(notifications))
          if(notifications[i] == "positive_results")
          document.getElementById("positive_results").checked = true;

          else if(notifications[i] == "negative_results")
          document.getElementById("negative_results").checked = true;

          else if(notifications[i] == "errors")
          document.getElementById("error").checked = true;

          else if(notifications[i] == "all")
          document.getElementById("all").checked = true;

        }
      }

      user_settings.username.value = user.username;
      user_settings.password.value = user.password;
      user_settings.re_password.value = user.password;
      user_settings.phonenumber.value = user.phonenumber;
      user_settings.email.value = user.email;
      user_settings.service_provider.value = user.service_provider.toLowerCase();

      function disable_other_notification_options() {
        if(document.getElementById("all").checked) {
          document.getElementById("positive_results").checked = false;
          document.getElementById("negative_results").checked = false;
          document.getElementById("error").checked = false;
        }
      }


      translate("settings");
    </script>

    <script type="text/javascript">
      var region = document.getElementById("region");
      var sub_region = document.getElementById("sub_region");
      var regions_success = function(sr) {
        console.log("found regions");
        for(var i in sr) {
          var name = sr[i].name;
          var id = sr[i].id;
          var option = id == JSON.parse(localStorage.getItem("user")).region_id ? new Option(name, id, true, true) : new Option(name, id);
          region.appendChild(option);
        }

        region.onchange = function() {
          console.log("getting sub regions");
          var id = this.value;
          var success = function(sr) {
            console.log("found subregions let's move on");
            sub_region.innerHTML = "";
            for(var i in sr) {
              var name = sr[i].name;
              var id = sr[i].id;
              var option = new Option(name, id);
              sub_region.appendChild(option);
            }
          };
          var failed = function() {}
          // transmission.fetch("region", success, failed, "communities", id);
          var information = {
            type : "get",
            uri : `/community?region_id='${id}'`,
            on_success : success,
            on_failed : failed
          }
          transmission_new(information);
        }
      };

      var communities_success = function(sr) {
        console.log("found subregions let's move on");
        sub_region.innerHTML = "";
        for(var i in sr) {
          var name = sr[i].name;
          var id = sr[i].id;
          var option = id == JSON.parse(localStorage.getItem("user")).community_id ? new Option(name, id, true, true) : new Option(name, id);
          sub_region.appendChild(option);
        }
      };

      var failed = function(sr) {
      };

      var information = {
        type : "get",
        uri : `/community?region_id='${JSON.parse(localStorage.getItem("user")).region_id}'`,
        on_success : communities_success,
        on_failed : failed
      }

      var information2 = {
        type : "get",
        uri : `/regions`,
        on_success : regions_success,
        on_failed : failed
      }
      transmission_new(information);
      transmission_new(information2);

    </script>
  </body>
</html>
